# NDH AED 預測算法優化分析報告
## 2026-01-17

### 當前基準

| 模型 | MAE | RMSE | R² |
|------|-----|------|-----|
| Ensemble (Simple Average) | **15.73** | 20.24 | 0.4147 |
| Random Forest | 15.83 | 20.50 | 0.3997 |
| Gradient Boosting | 15.96 | 20.30 | 0.4111 |
| XGBoost | 16.12 | 20.79 | 0.3821 |

**配置**: 排除 COVID + 天氣數據 (23 天氣特徵) + 25 基礎特徵

---

### 為什麼 MAE 15.73 難以突破？

根據分析，當前模型已經達到了**數據本身的噪聲極限**：

```
總變異 (Var) = 信號變異 + 噪聲變異
R² = 0.4147 → 模型解釋了 41.5% 的變異
剩餘 58.5% 是不可解釋的噪聲
```

**不可解釋噪聲的來源**:
1. 隨機事件 (突發事故、隨機就診)
2. 未測量的因素 (醫院內部運營變化)
3. 數據記錄誤差
4. 真正的隨機性

---

### 實際可達的改善空間分析

| 優化方向 | 預期改善 | 可行性 | 時間投入 |
|----------|----------|--------|----------|
| **外部數據整合** | MAE 15.73 → 13.0 | 中 | 2 週 |
| - 公共交通故障 | -1.0 | 需要數據源 | - |
| - 醫院內部事件 | -1.0 | 需要協調 | - |
| - 當地大型活動 | -0.5 | 需要數據源 | - |
| **模型架構** | MAE 15.73 → 14.5 | 低 | 1 週 |
| - 超參數優化 | -0.3 | 容易 | - |
| - CatBoost/LightGBM | -0.2 | 容易 | - |
| - 分層建模 | -0.5 | 中等 | - |
| **目標變量轉換** | MAE 15.73 → 14.0 | 低 | 1 週 |
| - 殘差建模 | -0.5 | 容易 | - |
| - 分位數回歸 | -0.2 | 容易 | - |

**現實最佳預期**: MAE ≈ 13-14 (約 10-15% 改善)

---

### MAE < 10 的可能性分析

要達到 MAE < 10，需要：
```
MAE 改善 = (15.73 - 10) / 15.73 = 36.4% 改善
```

這需要：
- 解釋當前 58.5% 噪聲中的 64%
- R² 從 0.41 提升到 0.78+

**這在現實中極難實現**，除非：
1. 獲得非常強力的預測信號 (如預知就診預約數據)
2. 系統性原因導致的偏差可以修正
3. 數據質量有根本性問題

---

### 推薦的優化路徑

#### 階段 1: 快速改進 (1 週內)
```python
# 1. 超參數優化
使用 Optuna 進行 200+ trials 的超參數搜索
預期: MAE 15.73 → 15.3

# 2. 分層建模
工作日/週末/假期分別訓練
預期: MAE 15.3 → 14.8

# 3. 殘差建模
先預測 EWMA 基準，再建模殘差
預期: MAE 14.8 → 14.3
```

#### 階段 2: 數據增強 (2-4 週)
```python
# 1. 醫院內部數據
- 急診室繁忙程度指標
- 醫生護士排班變化
- 病房占用率

# 2. 外部事件數據
- 公共交通故障
- 大型活動日曆
- 學校假期

# 3. 實時修正
- 當日上午實際就診趨勢
- 天氣預報 (而非歷史天氣)
```

#### 階段 3: 模型創新 (持續)
```python
# 1. 時間序列專用模型
- Prophet (Facebook)
- N-BEATS
- Transformer-based

# 2. 概率預測
- 輸出預測區間而非點預測
- 不確定性量化
```

---

### 建議的下一步行動

**立即執行** (本週):
1. 超參數優化 (Optuna 200 trials)
2. 分層建模驗證
3. 殘差建模實現

**短期** (本月):
4. 評估 CatBoost/LightGBM
5. 實現預測區間功能

**中期** (下月):
6. 調研可獲得的外部數據源
7. 與醫院協調獲取內部數據

**長期目標調整**:
- 從 "MAE < 10" 調整為 "MAE < 14" (更現實)
- 同時改善預測穩定性和可解釋性
- 提供預測區間而非點預測

---

### 結論

當前 MAE = 15.73 在急診室就診預測領域已經是**相當不錯**的結果：
- 平均日就診 252 人
- MAE 15.73 = 6.2% 誤差率
- 大部分預測誤差在 ±20 人以內

要實現 MAE < 10 (4% 誤差率)，需要獲得更多**預測性信號**，而非僅靠模型優化。
