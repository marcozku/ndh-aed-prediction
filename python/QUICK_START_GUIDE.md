# å¿«é€Ÿé–‹å§‹æŒ‡å— - å„ªåŒ–å¯¦æ–½

## ğŸ“‹ æ¦‚è¿°

é€™ä»½æŒ‡å—å°‡å¸¶ä½ é€æ­¥å¯¦æ–½å„ªåŒ–è¨ˆåŠƒï¼Œå¾æ¸¬è©¦æ¨¡çµ„åˆ°æœ€çµ‚éƒ¨ç½²ã€‚

---

## ç¬¬ 1 æ­¥: æ¸¬è©¦æ‰€æœ‰ç‰¹å¾µæ¨¡çµ„ (10 åˆ†é˜)

### 1.1 æ¸¬è©¦å¤©æ°£é å ±æ¨¡çµ„

```bash
cd python
python weather_forecast_integration.py
```

**é æœŸè¼¸å‡º**:
```
ğŸ“¡ ç²å–é¦™æ¸¯å¤©æ–‡å°å¤©æ°£é å ±...
   âœ… æˆåŠŸç²å– 9 å¤©é å ±
   ğŸ“… ç¯„åœ: 2026-01-18 â†’ 2026-01-26

ğŸ“Š æœªä¾† 9 å¤©é å ±:
æ—¥æœŸ          æ˜ŸæœŸ    æº«åº¦            é™é›¨æ©Ÿç‡    å¤©æ°£
2026-01-18   æ—¥      18Â°C - 22Â°C    Low         æŸå’Œ
2026-01-19   ä¸€      17Â°C - 21Â°C    Medium      æœ‰å¹¾é™£é›¨
...
```

### 1.2 æ¸¬è©¦æµæ„Ÿå­£ç¯€æ¨¡çµ„

```bash
python flu_season_features.py
```

**é æœŸè¼¸å‡º**:
```
ğŸ¦  æµæ„Ÿå­£ç¯€ç‰¹å¾µæ¨¡çµ„æ¸¬è©¦
1ï¸âƒ£ ä»Šå¤©çš„æµæ„Ÿç‰¹å¾µ
   æ—¥æœŸ: 2026-01-18
   Flu_Month: 1
   Flu_Season_Winter: 1
   Flu_Is_Peak: 1
   Flu_Intensity: 2.6
   ...
```

### 1.3 æ¸¬è©¦æ­·å²å¤©æ°£æ¨¡å¼æ¨¡çµ„

```bash
python historical_weather_patterns.py
```

**é æœŸè¼¸å‡º**:
```
ğŸŒ¡ï¸ æ­·å²å¤©æ°£æ¨¡å¼ç‰¹å¾µæ¸¬è©¦
1ï¸âƒ£ æ·»åŠ å¤©æ°£è®ŠåŒ–ç‰¹å¾µ...
   âœ… æ·»åŠ  17 å€‹å¤©æ°£è®ŠåŒ–ç‰¹å¾µ
2ï¸âƒ£ æ·»åŠ æ¥µç«¯å¤©æ°£ç‰¹å¾µ...
   âœ… æ·»åŠ  8 å€‹æ¥µç«¯å¤©æ°£ç‰¹å¾µ
...
   ç¸½ç‰¹å¾µæ•¸: 38
   æ•¸æ“šå½¢ç‹€: (365, 50)
```

---

## ç¬¬ 2 æ­¥: é‹è¡Œæ•´åˆè¨“ç·´ (30 åˆ†é˜)

### 2.1 åŸ·è¡Œå®Œæ•´è¨“ç·´

```bash
python train_integrated_optimization.py
```

**é æœŸè¼¸å‡º**:
```
ğŸš€ æ•´åˆå„ªåŒ–ç‰¹å¾µè¨“ç·´
1ï¸âƒ£ åŠ è¼‰æ•¸æ“š...
   âœ… æˆåŠŸåŠ è¼‰ 1500+ ç­†è¨˜éŒ„
2ï¸âƒ£ æ’é™¤ COVID æœŸé–“...
   ğŸ“Š éæ¿¾ COVID: 1500 â†’ 1200 ç­†
3ï¸âƒ£ ç²å–å¤©æ°£é å ±...
   âœ… æˆåŠŸç²å– 9 å¤©é å ±
4ï¸âƒ£ æº–å‚™ç‰¹å¾µ...
   âœ… åŸºç¤ç‰¹å¾µ
   âœ… æµæ„Ÿå­£ç¯€ç‰¹å¾µ
   âœ… æ·»åŠ  38 å€‹æ­·å²å¤©æ°£ç‰¹å¾µ
   âœ… å¤©æ°£é å ±ç‰¹å¾µ
5ï¸âƒ£ ç²å–ç‰¹å¾µåˆ—è¡¨...
   ğŸ“Š ç¸½ç‰¹å¾µæ•¸: 79
8ï¸âƒ£ è¨“ç·´æ¨¡å‹...
   è¨“ç·´ XGBoost...
   è¨“ç·´ Random Forest...
   è¨“ç·´ Gradient Boosting...
   è¨“ç·´ Ensemble...
9ï¸âƒ£ è©•ä¼°çµæœ...
ENSEMBLE:
   MAE:  14.23
   RMSE: 19.12
   RÂ²:   0.4856
```

### 2.2 æŸ¥çœ‹çµæœ

```bash
cat models/integrated_optimization_results.json
```

**é æœŸå…§å®¹**:
```json
{
  "timestamp": "2026-01-18 12:00:00",
  "baseline_mae": 15.73,
  "results": {
    "ensemble": {
      "MAE": 14.23,
      "RMSE": 19.12,
      "RÂ²": 0.4856
    }
  },
  "improvement_pct": 9.5,
  "feature_count": 79
}
```

---

## ç¬¬ 3 æ­¥: è©•ä¼°æ”¹å–„ (5 åˆ†é˜)

### 3.1 å°æ¯”åŸºæº–

| æ¨¡å‹ | èˆŠ MAE | æ–° MAE | æ”¹å–„ |
|------|--------|--------|------|
| Ensemble | 15.73 | 14.23 | +9.5% âœ… |
| XGBoost | 16.12 | 14.56 | +9.7% âœ… |
| Random Forest | 15.83 | 14.78 | +6.6% âœ… |

### 3.2 ç‰¹å¾µé‡è¦æ€§åˆ†æ

è¨“ç·´è…³æœ¬æœƒè‡ªå‹•è¼¸å‡º Top 15 ç‰¹å¾µé‡è¦æ€§ï¼š

```
ğŸ” ç‰¹å¾µé‡è¦æ€§ (Top 15)
   æ’å  ç‰¹å¾µ                          é‡è¦æ€§
   --------------------------------------------------
   1     Attendance_Lag1              0.2456
   2     Attendance_EWMA7             0.1876
   3     Forecast_Temp_Min            0.1234
   4     Flu_Is_Peak                  0.0987
   5     Temp_Change_1d               0.0876
   ...
```

---

## ç¬¬ 4 æ­¥: è¶…åƒæ•¸å„ªåŒ– (å¯é¸ï¼Œ2-3 å°æ™‚)

å¦‚æœåˆæ­¥çµæœæ»¿æ„ï¼Œå¯ä»¥é€²ä¸€æ­¥å„ªåŒ–ï¼š

### 4.1 å‰µå»ºè¶…åƒæ•¸å„ªåŒ–è…³æœ¬

```bash
# å‰µå»º scripts/hyperparameter_optimization.py
# (è¦‹ä¸‹æ–¹å®Œæ•´ä»£ç¢¼)
```

### 4.2 é‹è¡Œå„ªåŒ–

```bash
python scripts/hyperparameter_optimization.py
```

**é æœŸæ™‚é–“**: 2-3 å°æ™‚ (200 trials)
**é æœŸæ”¹å–„**: é¡å¤– 2-3%

---

## ç¬¬ 5 æ­¥: éƒ¨ç½²åˆ° Railway (30 åˆ†é˜)

### 5.1 æ›´æ–° model.js

ç¢ºä¿ä½¿ç”¨æ–°ç‰¹å¾µé€²è¡Œé æ¸¬ï¼š

```javascript
// prediction.js (Railway)

const { predictWithIntegratedFeatures } = require('./modules/integrated_prediction');

// ä½¿ç”¨æ–°ç‰¹å¾µé æ¸¬
const prediction = await predictWithIntegratedFeatures(date, features);
```

### 5.2 æ¨é€åˆ° Railway

```bash
git add python/*.py
git commit -m "Add integrated optimization features"
git push origin main
```

Railway æœƒè‡ªå‹•éƒ¨ç½²ã€‚

---

## å¸¸è¦‹å•é¡Œæ’æŸ¥

### å•é¡Œ 1: å¤©æ°£é å ± API å¤±æ•—

**éŒ¯èª¤**:
```
âŒ ç²å–å¤©æ°£é å ±å¤±æ•—: Connection timeout
```

**è§£æ±º**:
```python
# åœ¨ train_integrated_optimization.py ä¸­
# ç¢ºä¿å³ä½¿ API å¤±æ•—ä¹Ÿèƒ½ç¹¼çºŒè¨“ç·´
try:
    forecast_df = fetch_weather_forecast()
except:
    print("   âš ï¸ å¤©æ°£é å ±ç²å–å¤±æ•—ï¼Œä½¿ç”¨ç¾æœ‰ç‰¹å¾µè¨“ç·´")
    forecast_df = None
```

### å•é¡Œ 2: ç‰¹å¾µç¼ºå¤±

**éŒ¯èª¤**:
```
KeyError: 'Forecast_Temp_Min'
```

**è§£æ±º**:
```python
# æª¢æŸ¥å¯ç”¨ç‰¹å¾µ
available_features = [f for f in all_features if f in df.columns]
print(f"å¯ç”¨ç‰¹å¾µ: {len(available_features)}")

X_train = train_df[available_features]
```

### å•é¡Œ 3: è¨˜æ†¶é«”ä¸è¶³

**éŒ¯èª¤**:
```
MemoryError: Unable to allocate array
```

**è§£æ±º**:
```python
# æ¸›å°‘ç‰¹å¾µæ•¸é‡
selected_features = select_features_by_importance(model, X_train, feature_names, threshold=0.02)

# æˆ–æ¸›å°‘æ¨¡å‹è¤‡é›œåº¦
model = xgb.XGBRegressor(n_estimators=300, max_depth=6)  # é™ä½
```

---

## æˆåŠŸæ¨™æº–

### æœ€å°ç›®æ¨™ (å¿…é ˆé”æˆ)
- âœ… MAE < 15.2 (3% æ”¹å–„)
- âœ… æ‰€æœ‰æ¨¡çµ„æ¸¬è©¦é€šé
- âœ… è¨“ç·´ç„¡éŒ¯èª¤

### ç†æƒ³ç›®æ¨™ (åŠªåŠ›é”æˆ)
- âœ… MAE < 14.5 (8% æ”¹å–„)
- âœ… RÂ² > 0.48
- âœ… ç‰¹å¾µé‡è¦æ€§åˆç†

### æœ€ä½³ç›®æ¨™ (å¦‚æœ‰æ™‚é–“)
- âœ… MAE < 14.0 (11% æ”¹å–„)
- âœ… RÂ² > 0.50
- âœ… è¶…åƒæ•¸å„ªåŒ–å®Œæˆ

---

## ä¸‹ä¸€æ­¥å„ªåŒ– (å¦‚æœæ™‚é–“å…è¨±)

### 1. åˆ†å±¤å»ºæ¨¡
```bash
python scripts/train_stratified_models.py
```

### 2. Stacking Ensemble
```bash
python scripts/train_stacking_ensemble.py
```

### 3. æ™‚é–“åºåˆ—äº¤å‰é©—è­‰
```bash
python scripts/time_series_cv.py
```

---

## ç¸½çµ

**é è¨ˆç¸½æ™‚é–“**:
- æ¸¬è©¦æ¨¡çµ„: 10 åˆ†é˜
- é‹è¡Œè¨“ç·´: 30 åˆ†é˜
- è©•ä¼°çµæœ: 5 åˆ†é˜
- **ç¸½è¨ˆ**: ~45 åˆ†é˜

**é æœŸçµæœ**:
- MAE: 14.2-14.8 (8-10% æ”¹å–„)
- RÂ²: 0.46-0.50
- 79 å€‹ç‰¹å¾µå…¨éƒ¨ä¸Šç·š

**å¦‚æœæˆåŠŸ**:
- éƒ¨ç½²åˆ° Railway
- ç›£æ§å¯¦éš›é æ¸¬è¡¨ç¾
- æ”¶é›†åé¥‹é€²è¡Œè¿­ä»£

---

**ç¾åœ¨é–‹å§‹å§ï¼** ğŸš€

```bash
cd python
python weather_forecast_integration.py
```
