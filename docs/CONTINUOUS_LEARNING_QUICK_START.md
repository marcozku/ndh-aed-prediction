# 自動學習系統 - 快速指南
## Continuous Learning System - Quick Guide

> **版本**: 4.0.00
> **日期**: 2026-01-18

---

## 系統概述

這個系統會**自動學習**天氣因素和 AI 因素對 attendance 的影響，並在下次類似情況發生時自動調整預測。

---

## 學習流程圖

```
┌─────────────────────────────────────────────────────────────────┐
│                     每日自動學習循環                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 獲取昨日實際數據  ──┐                                       │
│  2. 計算預測誤差        │                                       │
│  3. 記錄天氣條件        │                                       │
│  4. 記錄 AI 因素        │                                       │
│  5. 檢測異常            │                                       │
│  6. 更新學習參數        ┘                                       │
│                                                                  │
│           ⬇️                                                     │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  學習結果:                                              │    │
│  │  - 寒冷天氣 (temp_min ≤ 12°C)   → 平均 -6.8 人         │    │
│  │  - 大雨 (rainfall > 25mm)       → 平均 -4.9 人         │    │
│  │  - 馬拉松事件                    → 平均 -15%           │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 使用場景示例

### 場景 1: 天氣預報整合

**情況**: 明天預報寒冷天氣 (8°C) + 大雨

**系統自動處理**:
```
1. XGBoost 基礎預測: 250 人
2. 檢查學習參數:
   - 寒冷天氣: -6.8 人
   - 大雨: -4.9 人
3. 調整預測: 250 - 6.8 - 4.9 = 238 人
```

### 場景 2: AI 事件學習

**情況**: AI 檢測到馬拉松活動，建議 -15%

**系統自動驗證**:
```
1. 記錄 AI 預測: 250 × 0.85 = 213 人
2. 記錄實際結果: 218 人
3. 驗證 AI 準確性: 誤差僅 5 人 ✅
4. 學習: 馬拉松活動平均影響 -12%
```

### 場景 3: 異常檢測

**情況**: 預測 250 人，實際只有 180 人 (差距 70 人)

**系統自動處理**:
```
1. 標記為異常 (誤差 > 15)
2. 分析當日條件: 發現 T8 台風
3. 記錄: T8 台風 → 平均 -12.1 人
4. 下次 T8 時自動調整預測
```

---

## 文件結構

```
migrations/
  └── 004_continuous_learning.sql      # 數據庫結構

python/
  ├── continuous_learner.py            # 每日學習引擎
  ├── anomaly_detector.py              # 異常檢測
  ├── weather_impact_learner.py        # 天氣影響學習
  └── forecast_predictor.py            # 預報預測整合

modules/
  └── learning-scheduler.js            # Node.js 定時調度

docs/
  └── CONTINUOUS_LEARNING_DESIGN.md    # 完整設計文檔
```

---

## API 端點

| 端點 | 方法 | 描述 |
|------|------|------|
| `/api/learning/summary` | GET | 學習系統摘要 |
| `/api/learning/weather-impacts` | GET | 當前天氣影響參數 |
| `/api/learning/anomalies` | GET | 異常事件列表 |
| `/api/learning/update` | POST | 觸發手動學習更新 |

---

## 實施狀態

| 階段 | 狀態 | 描述 |
|------|------|------|
| Phase 1: 自動記錄 | ✅ 已部署 | 每日記錄預測 vs 實際 |
| Phase 2: 異常檢測 | ✅ 已部署 | 自動 flag 高誤差日子 |
| Phase 3: 學習模型 | ✅ 已部署 | 迴歸模型學習影響 |
| Phase 4: 預報整合 | ✅ 已部署 | 用天氣預報調整預測 |

---

## 預期效果

### 當前 (v3.2.01)
- MAE: 2.85 人
- 天氣影響: 靜態 JSON 文件
- AI 因素: w_AI = 0.00 (未啟用)

### 實現後 (v4.0.00)
- MAE: 目標 < 2.5 人
- 天氣影響: 動態數據庫，每日更新
- AI 因素: 自動驗證和啟用

---

## 快速開始

### 1. 運行 Migration

```bash
psql $DATABASE_URL < migrations/004_continuous_learning.sql
```

### 2. 測試學習引擎

```bash
python python/continuous_learner.py
```

### 3. 查看學習結果

```bash
curl http://localhost:3000/api/learning/weather-impacts
```

---

**完整設計**: 請參考 [CONTINUOUS_LEARNING_DESIGN.md](./CONTINUOUS_LEARNING_DESIGN.md)
