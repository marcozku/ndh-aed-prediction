# 基於真實研究的預測算法改進

## 📚 研究發現總結

### 1. **最佳實踐方法**
- **XGBoost**: MAE 2.63-2.64 (法國醫院研究)
- **LSTM網絡**: 優於ARIMA和Prophet，特別是在數據分佈變化時
- **Prophet**: 適合強季節性模式
- **集成方法**: 結合多種模型可提高準確度

### 2. **關鍵預測因子**
- **星期效應**: 週一最高（124%），週末最低（70%）
- **天氣**: 惡劣天氣減少，高溫增加
- **季節性**: 呼吸系統問題有季節趨勢
- **假期**: 顯著影響

### 3. **準確度目標**
- **MAE**: < 3 病人
- **MAPE**: < 7%
- **95% CI準確率**: > 90%

## 🚀 實施的改進

### 1. 滾動窗口計算（基於LSTM研究）
- 使用最近90-180天的數據計算因子
- 動態適應數據分佈變化

### 2. 加權平均（基於時間序列研究）
- 給最近數據更高權重
- 指數衰減權重

### 3. 改進的星期因子（基於研究發現）
- 為每個月份計算獨立因子
- 考慮月份-星期交互效應

### 4. 趨勢調整（基於Prophet研究）
- 計算短期趨勢（7天）
- 計算長期趨勢（30天）
- 應用趨勢調整

### 5. 改進的置信區間（基於統計研究）
- 使用滾動窗口標準差
- 保守估計（擴大範圍）
- 考慮預測不確定性

### 6. 集成預測（基於集成學習研究）
- 多模型預測
- 加權平均結果
- 減少單一模型偏差

### 7. 改進的天氣因子（基於天氣研究）
- 更精確的溫度影響
- 相對溫度（與歷史平均比較）
- 多天氣變量組合

## 🌡️ 天氣影響研究參考 (v3.0.9)

### 學術研究發現

| 研究來源 | 發現 | DOI |
|----------|------|-----|
| Environmental Health Perspectives (2019) | 溫度急劇變化比絕對溫度更影響急診就診 | 10.1289/EHP4898 |
| Disaster Medicine & Public Health Preparedness (2018) | 颱風期間急診就診減少 20-40%，風後 2-3 天反彈 | 10.1017/dmp.2017.149 |
| Hong Kong Medical Journal (2020) | 暴雨警告日急診就診減少，但創傷個案增加 | 10.12809/hkmj198354 |
| International Journal of Cardiology (2017) | 寒冷天氣增加心血管和呼吸系統疾病急診 | 10.1016/j.ijcard.2017.01.097 |
| Environmental Research (2021) | 酷熱天氣增加中暑、熱衰竭和腎臟疾病急診 | 10.1016/j.envres.2020.110509 |

### 實施的天氣特徵 (v3.0.10)

**溫度變化特徵**：
- `Weather_Temp_Change` - 今天 vs 昨天的溫度變化
- `Weather_Temp_Drop_5` - 驟降 ≥5°C（研究顯示增加呼吸道疾病）
- `Weather_Temp_Rise_5` - 驟升 ≥5°C（研究顯示增加中暑風險）

**極端天氣事件**：
- `Typhoon_Signal` - 颱風信號（0/1/3/8/10）
- `Typhoon_T3_Plus` - T3 或以上（交通受阻，減少非緊急就診）
- `Typhoon_T8_Plus` - 8號風球或以上（顯著減少就診，但創傷增加）

**暴雨警告**：
- `Rainstorm_Warning` - 暴雨警告級別（0/1/2/3）
- `Rainstorm_Red_Plus` - 紅雨或以上
- `Rainstorm_Black` - 黑色暴雨（戶外活動停止）

**天氣警告**：
- `Hot_Warning` - 酷熱天氣警告（HKO 發出）
- `Cold_Warning` - 寒冷天氣警告（HKO 發出）

### 數據來源
- `python/weather_history.csv` - HKO 打鼓嶺站歷史天氣（1988年至今）
- `python/weather_warnings_history.csv` - 颱風/暴雨/警告歷史（手動維護）

### 8. 異常檢測和調整（基於異常檢測研究）
- 檢測異常預測值
- 自動調整到合理範圍
- 使用歷史分位數
