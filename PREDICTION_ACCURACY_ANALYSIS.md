# 預測準確度分析報告

## 📊 實際數據（1/12 到 12/12）

| 日期 | 星期 | 實際人數 | 預測人數 | 誤差 | 誤差% |
|------|------|---------|---------|------|-------|
| 2025-12-01 | 一 | 276 | ? | ? | ? |
| 2025-12-02 | 二 | 285 | ? | ? | ? |
| 2025-12-03 | 三 | 253 | ? | ? | ? |
| 2025-12-04 | 四 | 234 | ? | ? | ? |
| 2025-12-05 | 五 | 262 | ? | ? | ? |
| 2025-12-06 | 六 | 234 | ? | ? | ? |
| 2025-12-07 | 日 | 244 | ? | ? | ? |
| 2025-12-08 | 一 | 293 | ? | ? | ? |
| 2025-12-09 | 二 | 253 | ? | ? | ? |
| 2025-12-10 | 三 | 219 | ? | ? | ? |
| 2025-12-11 | 四 | 275 | ? | ? | ? |
| 2025-12-12 | 五 | 248 | ? | ? | ? |

**平均值：** 253.3 人  
**範圍：** 219 - 293 人  
**標準差：** ~23.5 人

## 🔍 預測算法分析

### 當前預測公式

```
預測值 = 全局平均 × 月份因子 × 星期因子 × 假期因子 × 流感季節因子 × 天氣因子 × AI因子
```

### 算法組件

1. **全局平均 (globalMean)**
   - 基於歷史數據計算
   - 問題：如果歷史數據範圍太廣，可能不反映當前趨勢

2. **月份因子 (monthFactors)**
   - 每個月的平均相對於全局平均的比率
   - 12月的因子可能基於去年的數據

3. **星期因子 (dowFactors)**
   - 每個星期的平均相對於全局平均的比率
   - 可能沒有考慮到12月的特殊情況

4. **假期因子**
   - 12月25-26日是聖誕節假期（factor: 0.91, 0.95）
   - 1/12 到 12/12 期間沒有假期

5. **流感季節因子**
   - 12月不在流感季節（1,2,3,7,8月）
   - 不會應用

6. **天氣因子**
   - 動態計算，基於實際天氣數據
   - 可能影響較小

7. **AI因子**
   - 基於AI分析的事件和因素
   - 可能不準確或過度影響

### 置信區間計算

```
CI80: value ± 1.28 × stdDev
CI95: value ± 1.96 × stdDev
```

**問題：** 標準差是基於歷史數據計算的，可能不反映當前的波動性

## ⚠️ 潛在問題

### 1. **歷史數據偏差**
- 如果歷史數據包含很多舊數據，全局平均可能不反映當前水平
- 12月的歷史數據可能來自去年，今年可能有變化

### 2. **因子疊加問題**
- 多個因子相乘可能導致過度調整
- 例如：月份因子 × 星期因子可能產生極端值

### 3. **標準差估計不準確**
- 如果歷史標準差是25，但實際波動更大，置信區間會太窄
- 從實際數據看，範圍是219-293（74人的範圍），標準差約23.5

### 4. **缺少趨勢因素**
- 算法沒有考慮長期趨勢
- 沒有考慮最近幾天的實際數據來調整預測

### 5. **星期因子可能不準確**
- 12月的星期模式可能與全年平均不同
- 例如：12月初可能有特殊活動或事件

### 6. **天氣和AI因子影響不確定**
- 這些因子的權重可能過大或過小
- 沒有驗證這些因子的實際效果

## 💡 改進建議

### 1. **使用滾動窗口計算全局平均**
```javascript
// 只使用最近N天的數據計算平均
const recentData = historicalData.slice(-90); // 最近90天
const globalMean = calculateMean(recentData);
```

### 2. **調整因子計算方法**
- 使用加權平均而非簡單平均
- 給最近的數據更高權重
- 考慮季節性變化

### 3. **改進標準差計算**
```javascript
// 使用滾動窗口的標準差
const recentStdDev = calculateStdDev(recentData);

// 或使用更保守的估計
const adjustedStdDev = Math.max(recentStdDev, 30); // 至少30
```

### 4. **添加趨勢調整**
```javascript
// 計算最近7天的趨勢
const recentTrend = calculateTrend(last7Days);
const trendAdjustment = recentTrend * trendWeight;
value += trendAdjustment;
```

### 5. **改進星期因子**
- 為每個月份計算獨立的星期因子
- 12月的星期模式可能與其他月份不同

### 6. **驗證和調整因子權重**
- 回測所有因子，找出哪些最有效
- 調整天氣和AI因子的權重
- 考慮使用機器學習來優化權重

### 7. **擴大置信區間**
```javascript
// 使用更保守的置信區間
const ci80 = {
    lower: Math.max(0, Math.round(value - 1.5 * stdDev)),
    upper: Math.round(value + 1.5 * stdDev)
};

const ci95 = {
    lower: Math.max(0, Math.round(value - 2.5 * stdDev)),
    upper: Math.round(value + 2.5 * stdDev)
};
```

### 8. **添加異常檢測**
- 檢測預測值是否在合理範圍內
- 如果預測值異常，使用更保守的估計

### 9. **實時調整機制**
- 當實際數據與預測差異較大時，自動調整模型參數
- 使用實際數據來更新因子

### 10. **分層預測**
- 分別預測工作日和週末
- 分別預測不同季節
- 使用不同的模型參數

## 🔬 診斷步驟

1. **檢查歷史數據範圍**
   - 確認全局平均是基於多少天的數據
   - 檢查是否有異常值影響平均

2. **驗證因子值**
   - 檢查12月的月份因子
   - 檢查各星期的因子值
   - 確認因子是否合理

3. **分析誤差模式**
   - 是否有系統性偏差（總是高估或低估）
   - 特定星期是否誤差更大
   - 是否有異常日期

4. **測試因子效果**
   - 暫時移除天氣因子，看是否改善
   - 暫時移除AI因子，看是否改善
   - 測試不同因子組合

5. **回測驗證**
   - 使用歷史數據回測模型
   - 找出最佳參數組合

## 📈 預期改進效果

實施這些改進後，預期可以：
- 將平均誤差降低 30-50%
- 將 80% CI 準確率提升到 70%+
- 將 95% CI 準確率提升到 90%+
- 減少異常誤差（>15%）的發生率

## 🎯 優先級建議

**高優先級：**
1. 使用滾動窗口計算全局平均和標準差
2. 擴大置信區間範圍
3. 為12月計算獨立的星期因子

**中優先級：**
4. 添加趨勢調整
5. 驗證和調整天氣/AI因子權重
6. 添加異常檢測

**低優先級：**
7. 實施機器學習優化
8. 分層預測模型
9. 實時調整機制
