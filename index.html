<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta name="description" content="NDH AED 病人數量預測系統 - 北區醫院急症室人流預測">
    <meta name="theme-color" content="#f8fafc">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="北區醫院預測">
    
    <!-- Icons - v4 -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg?v=4">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png?v=4">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180.png?v=4">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152.png?v=4">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120.png?v=4">
    <link rel="manifest" href="/manifest.json?v=4">
    
    <title>NDH AED 預測系統</title>
    <link rel="stylesheet" href="styles.css?v=4">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
</head>
<body>
    <!-- 主內容 -->
    <div class="prediction-container">
        <!-- 標題區 -->
        <header class="prediction-header">
            <h1>NDH AED 病人數量預測系統</h1>
            <p class="subtitle">North District Hospital A&E Attendance Prediction</p>
            <div class="current-datetime" id="current-datetime">
                <span>⏱️</span>
                <span>載入中...</span>
            </div>
            <div class="weather-display" id="weather-display">
                <span class="weather-loading">載入天氣資料...</span>
            </div>
            <div class="db-status loading" id="db-status">
                <span>檢查數據庫連接...</span>
            </div>
            <div class="ai-status loading" id="ai-status">
                <span>檢查 AI 連接...</span>
            </div>
        </header>

        <!-- 今日預測卡片 -->
        <section class="today-prediction">
            <div class="section-loading" id="today-prediction-loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">載入中... <span class="loading-percent" id="today-prediction-percent">0%</span></div>
                <div class="loading-progress-bar">
                    <div class="loading-progress-fill" id="today-prediction-progress"></div>
                </div>
            </div>
            <div class="prediction-card main-card" id="today-prediction-card" style="display: none;">
                <div class="card-header">
                    <h2>今日預測</h2>
                    <span class="date-badge" id="today-date">--</span>
                </div>
                <div class="prediction-value">
                    <span class="big-number" id="today-predicted">--</span>
                    <span class="unit">人</span>
                </div>
                <div class="confidence-interval">
                    <div class="ci-row">
                        <span class="ci-label">80% 信賴區間</span>
                        <span class="ci-value" id="today-ci80">-- - -- 人</span>
                    </div>
                    <div class="ci-row">
                        <span class="ci-label">95% 信賴區間</span>
                        <span class="ci-value" id="today-ci95">-- - -- 人</span>
                    </div>
                </div>
                <div class="factors-breakdown" id="factors-breakdown">
                    <!-- 動態生成 -->
                </div>
            </div>

            <!-- 統計摘要卡片 -->
            <div class="prediction-card stats-card" id="stats-card" style="display: none;">
                <div class="card-header">
                    <h2>歷史統計</h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value" id="stat-mean">--</span>
                        <span class="stat-label">日均人數</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="stat-max">--</span>
                        <span class="stat-label">最高峰</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="stat-min">--</span>
                        <span class="stat-label">最低谷</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="stat-std">--</span>
                        <span class="stat-label">標準差</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 實時影響因素 -->
        <section class="realtime-factors-section">
            <h2>實時影響因素</h2>
            <div class="section-loading" id="realtime-factors-loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">載入中... <span class="loading-percent" id="realtime-factors-percent">0%</span></div>
                <div class="loading-progress-bar">
                    <div class="loading-progress-fill" id="realtime-factors-progress"></div>
                </div>
            </div>
            <div class="factors-container" id="realtime-factors" style="display: none;">
                <div class="factors-loading">
                    <span>⏳ 載入 AI 分析中...</span>
                </div>
            </div>
        </section>

        <!-- 未來7天預測 -->
        <section class="forecast-section">
            <h2>未來 7 天預測</h2>
            <div class="section-loading" id="forecast-cards-loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">載入中... <span class="loading-percent" id="forecast-cards-percent">0%</span></div>
                <div class="loading-progress-bar">
                    <div class="loading-progress-fill" id="forecast-cards-progress"></div>
                </div>
            </div>
            <div class="forecast-cards" id="forecast-cards" style="display: none;">
                <!-- 動態生成 -->
            </div>
        </section>

        <!-- 圖表區域 -->
        <section class="charts-section">
            <!-- 未來30天預測圖 -->
            <div class="chart-card full-width">
                <h3>未來 30 天預測趨勢</h3>
                <div class="chart-container" id="forecast-chart-container">
                    <div class="chart-loading" id="forecast-chart-loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">載入中... <span class="loading-percent" id="forecast-loading-percent">0%</span></div>
                        <div class="loading-progress-bar">
                            <div class="loading-progress-fill" id="forecast-progress-fill"></div>
                        </div>
                    </div>
                    <canvas id="forecast-chart" style="display: none;"></canvas>
                </div>
            </div>

            <!-- 星期效應圖 -->
            <div class="chart-card">
                <h3>星期效應分析</h3>
                <div class="chart-container" id="dow-chart-container">
                    <div class="chart-loading" id="dow-chart-loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">載入中... <span class="loading-percent" id="dow-loading-percent">0%</span></div>
                        <div class="loading-progress-bar">
                            <div class="loading-progress-fill" id="dow-progress-fill"></div>
                        </div>
                    </div>
                    <canvas id="dow-chart" style="display: none;"></canvas>
                </div>
            </div>

            <!-- 月份分佈圖 -->
            <div class="chart-card">
                <h3>月份分佈統計</h3>
                <div class="chart-container" id="month-chart-container">
                    <div class="chart-loading" id="month-chart-loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">載入中... <span class="loading-percent" id="month-loading-percent">0%</span></div>
                        <div class="loading-progress-bar">
                            <div class="loading-progress-fill" id="month-progress-fill"></div>
                        </div>
                    </div>
                    <canvas id="month-chart" style="display: none;"></canvas>
                </div>
            </div>

            <!-- 歷史趨勢圖 -->
            <div class="chart-card full-width">
                <h3>歷史趨勢 (365 天)</h3>
                <div class="chart-container large" id="history-chart-container">
                    <div class="chart-loading" id="history-chart-loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">載入中... <span class="loading-percent" id="history-loading-percent">0%</span></div>
                        <div class="loading-progress-bar">
                            <div class="loading-progress-fill" id="history-progress-fill"></div>
                        </div>
                    </div>
                    <canvas id="history-chart" style="display: none;"></canvas>
                </div>
            </div>
        </section>

        <!-- 算法說明 -->
        <section class="algorithm-section">
            <h2>預測算法說明</h2>
            <div class="algorithm-content">
                <div class="algorithm-formula">
                    <h4>預測公式</h4>
                    <code>預測值 = 全局平均 × 月份因子 × 星期因子 × 假期因子 × 流感季節因子 × 天氣因子 × AI因子</code>
                </div>
                
                <div class="factors-table">
                    <h4>關鍵影響因子</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>因子</th>
                                <th>效應</th>
                                <th>說明</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>星期一效應</td>
                                <td class="positive">+9.0%</td>
                                <td>週末積壓 Monday Surge</td>
                            </tr>
                            <tr>
                                <td>週末效應</td>
                                <td class="negative">-7% ~ -9%</td>
                                <td>人流自然減少</td>
                            </tr>
                            <tr>
                                <td>農曆新年初一</td>
                                <td class="negative">-27%</td>
                                <td>最顯著假期效應</td>
                            </tr>
                            <tr>
                                <td>一般假期</td>
                                <td class="negative">-7.4%</td>
                                <td>標準公眾假期</td>
                            </tr>
                            <tr>
                                <td>流感季節</td>
                                <td class="positive">+0.4%</td>
                                <td>1-3月、7-8月高峰</td>
                            </tr>
                            <tr>
                                <td>十月高峰</td>
                                <td class="positive">+5.1%</td>
                                <td>季節轉換 + 開學效應</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="considerations">
                    <h4>預測考量因素</h4>
                    <ul>
                        <li>異常天氣 (寒流/颱風) 可降低 10-13% 人流</li>
                        <li>節日前夕 (如中秋前夜) 人流可能異常低</li>
                        <li>流感高峰期間可能出現單日 300+ 人流</li>
                        <li>長假期後首個工作日可能有反彈效應</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- 頁腳 -->
        <footer class="prediction-footer">
            <p>數據來源：NDH AED 2024-12-03 至 2025-12-03 歷史數據 (366天)</p>
            <p>預測模型版本 1.1.2 · 香港時間 HKT</p>
        </footer>
    </div>

    <script src="prediction.js?v=4"></script>
</body>
</html>

